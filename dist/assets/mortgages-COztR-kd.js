import"./styles-DoX-3eds.js";/* empty css               */function Q(a){const t=a.map(n=>new Date(n.DT_DEBUT_MOIS)),e=new Date(Math.min(...t)),l=new Date(Math.max(...t));return{minDate:e,maxDate:l}}function G(a,t,e,l,n){return a.filter(r=>{const o=new Date(r.DT_DEBUT_MOIS),u=o.getUTCFullYear(),p=o.getUTCMonth()+1,h=u>=t&&u<=e;let s=!1;return u===t&&u===e?s=p>=l&&p<=n:u===t?s=p>=l:u===e?s=p<=n:s=!0,h&&s})}function V(a,t){return a.filter(e=>t.includes(e.ID_REGN_ADMIN.toString().padStart(3,"0")))}function T(a,t,e,l,n,r){const o=G(a,e,l,n,r),u=V(o,t),p=d3.group(u,s=>new Date(s.DT_DEBUT_MOIS));return Array.from(p,([s,i])=>{const c={date:s};return i.forEach(d=>{c[d.ID_REGN_ADMIN]=d.NB_REQST}),c})}function $(a,t,e){return a.filter(n=>{const r=new Date(n.date);return r.getUTCFullYear()===t&&r.getUTCMonth()+1===e}).reduce((n,r)=>{let o=0;for(let u in r)u!=="date"&&!isNaN(r[u])&&(o+=r[u]);return n+o},0)}const j=["001","002","003","004","005","006","007","008","009","010","011","012","013","014","015","016","017"],J={"001":"01 - Bas-Saint-Laurent","002":"02 - Saguenay-Lac-Saint-Jean","003":"03 - Capitale-Nationale","004":"04 - Mauricie","005":"05 - Estrie","006":"06 - Montréal","007":"07 - Outaouais","008":"08 - Abitibi-Témiscamingue","009":"09 - Côte-Nord","010":"10 - Nord-du-Québec","011":"11 - Gaspésie-Îles-de-la-Madeleine","012":"12 - Chaudière-Appalaches","013":"13 - Laval","014":"14 - Lanaudière","015":"15 - Laurentides","016":"16 - Montérégie","017":"17 - Centre-du-Québec"},X={1:"01 - Bas-Saint-Laurent",2:"02 - Saguenay-Lac-Saint-Jean",3:"03 - Capitale-Nationale",4:"04 - Mauricie",5:"05 - Estrie",6:"06 - Montréal",7:"07 - Outaouais",8:"08 - Abitibi-Témiscamingue",9:"09 - Côte-Nord",10:"10 - Nord-du-Québec",11:"11 - Gaspésie-Îles-de-la-Madeleine",12:"12 - Chaudière-Appalaches",13:"13 - Laval",14:"14 - Lanaudière",15:"15 - Laurentides",16:"16 - Montérégie",17:"17 - Centre-du-Québec"},O={"001":"#F5525B","002":"#FAB578","003":"#8EC1CF","004":"#59A4D0","005":"#EFCB09","006":"#D0E009","007":"#ADBE17","008":"#01B850","009":"#01A689","010":"#02A3A3","011":"#8888CF","012":"#7AD2F7","013":"#096EBE","014":"#B266EB","015":"#CB96C4","016":"#810856","017":"#E10064"},g=["001","002","003","004","005","006","007","008","009","010","011","012","013","014","015","016","017"],K=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17"];function P(a,t){const e=d3.scaleTime().range([0,a]),l=d3.scaleLinear().range([t,0]),n=d3.scaleOrdinal().domain(Object.keys(O)).range(Object.values(O));return{xScale:e,yScale:l,color:n}}function Z(a,t,e,l){a.domain([d3.min(e,n=>new Date(n.date)),d3.max(e,n=>new Date(n.date))]),t.domain([0,d3.max(l,n=>d3.max(n,r=>r[1]))])}function S(a){return d3.stack().keys(a).value((t,e)=>t[e]||0).order(d3.stackOrderNone).offset(d3.stackOffsetNone)}function W(a,t,e,l,n,r,o,u){a.selectAll(".layer").data(t).join("path").attr("class","layer").attr("d",d3.area().x(i=>e(new Date(i.data.date))).y0(i=>l(i[0])).y1(i=>l(i[1])).curve(d3.curveLinear)).attr("fill",(i,c)=>n(c));const p=["jan","fév","mar","avr","mai","jun","jul","aoû","sep","oct","nov","déc"],h=d3.axisBottom(e).ticks(d3.timeMonth.every(1)).tickFormat(i=>{const c=new Date(i),d=c.getMonth(),m=c.getFullYear();return`${p[d]}-${m.toString().substr(-2)}`}).tickSize(-r).tickSizeOuter(0),s=d3.axisLeft(l).ticks(10).tickSize(-o).tickSizeOuter(0);a.selectAll(".x-axis").data([0]).join("g").attr("class","x-axis").attr("transform",`translate(0,${r})`).call(h).selectAll("text").style("text-anchor","end").attr("dx","-0.8em").attr("dy","0.15em").attr("transform","rotate(-45)"),a.selectAll(".y-axis").data([0]).join("g").attr("class","y-axis").call(s),a.selectAll(".x-axis .tick line").attr("stroke","lightgrey").attr("stroke-dasharray","2,2"),a.selectAll(".y-axis .tick line").attr("stroke","lightgrey").attr("stroke-dasharray","2,2"),a.append("text").attr("class","x-axis-label").attr("text-anchor","middle").attr("x",o/2).attr("y",r+55).text("Temps (mois-année)"),a.append("text").attr("class","y-axis-label").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("x",-r/2).attr("y",-50).text("Nombre total d'hyphothèques"),t.forEach((i,c)=>{a.selectAll(`.dot-${c}`).data(i).join("circle").attr("class",`dot-${c}`).attr("cx",d=>e(new Date(d.data.date))).attr("cy",d=>l(d[1])).attr("r",6).attr("fill","black").style("opacity",0).on("mouseover",(d,m)=>{let L=0,w=null,F=null;Object.keys(m.data).forEach(x=>{typeof m.data[x]=="number"&&(L+=m.data[x],L===m[1]&&(w=x,F=m.data[x]))}),d3.select("#tooltip").html(`Région: ${u[w]} <br>Date: ${m.data.date.toISOString().substring(0,7)}<br>Nombre d'hypohtèques spécifique à cette région: ${F} <br >Nombre d'hypohtèques total avec les régions inférieurs: ${m[1]}`).style("visibility","visible").style("left",`${d.pageX+10}px`).style("top",`${d.pageY-50}px`),d3.select(d.currentTarget).style("opacity",1).attr("r",5)}).on("mouseout",d=>{d3.select("#tooltip").style("visibility","hidden"),d3.select(d.currentTarget).style("opacity",0).attr("r",3)})})}function tt(a,t,e,l,n,r,o,u,p,h){const s=new Date(o,p-1),i=new Date(u,h-1),c=new Date(r[0].date),d=new Date(r[r.length-1].date),m=c.getUTCFullYear(),L=c.getUTCMonth()+1,w=d.getUTCFullYear(),F=d.getUTCMonth()+1;a.selectAll(".invalid-marker-message").remove();let x=!1;if((o<m||o===m&&p<L||u>w||u===w&&h>F)&&(x=!0,a.append("text").attr("class","invalid-marker-message").attr("x",n/2).attr("y",-10).attr("text-anchor","middle").attr("fill","red").attr("font-size","14px").text("Assurez-vous que les dates des marqueurs ne soient pas à l'extérieur de la période couverte.")),(u<o||o>u||u<=o&&h<p)&&(x=!0,a.append("text").attr("class","invalid-marker-message").attr("x",n/2).attr("y",-10).attr("text-anchor","middle").attr("fill","red").attr("font-size","14px").text("Assurez-vous que la date du marqueur A soit inférieur ou égale à celle du marqueur B.")),x?a.selectAll("marker-line").remove():(a.append("line").attr("class","marker-line").attr("x1",t(s)).attr("x2",t(s)).attr("y1",0).attr("y2",l).attr("stroke","black").attr("stroke-width",2).attr("stroke-dasharray","5,5"),a.append("line").attr("class","marker-line").attr("x1",t(i)).attr("x2",t(i)).attr("y1",0).attr("y2",l).attr("stroke","black").attr("stroke-width",2).attr("stroke-dasharray","5,5")),!x){const M=$(r,o,p),E=$(r,u,h),U=(E-M)/M*100;let f="";U>0?f=`Augmentation de ${U.toFixed(2)}% du nombre d'hypothèques.`:U<0?f=`Diminution de ${U.toFixed(2)*-1}% du nombre d'hypothèques.`:f="Aucune variation des hypothèques.",f==="Aucune variation des hypothèques."?t(i)<150?(a.append("text").attr("class","net-variation-text").attr("x",0).attr("y",-10).attr("fill","black").attr("font-size","14px").attr("font-weight","bold").text(f),a.append("line").attr("class","slope-line").attr("x1",t(s)).attr("x2",t(i)).attr("y1",e(M)).attr("y2",e(E)).attr("stroke","blue").attr("stroke-width",2).attr("stroke-dasharray","5,5")):t(s)>800&&t(i)>800?(a.append("text").attr("class","net-variation-text").attr("x",680).attr("y",-10).attr("fill","black").attr("font-size","14px").attr("font-weight","bold").text(f),a.append("line").attr("class","slope-line").attr("x1",t(s)).attr("x2",t(i)).attr("y1",e(M)).attr("y2",e(E)).attr("stroke","blue").attr("stroke-width",2).attr("stroke-dasharray","5,5")):(a.append("text").attr("class","net-variation-text").attr("x",t(i)-100).attr("y",-10).attr("fill","black").attr("font-size","14px").attr("font-weight","bold").text(f),a.append("line").attr("class","slope-line").attr("x1",t(s)).attr("x2",t(i)).attr("y1",e(M)).attr("y2",e(E)).attr("stroke","blue").attr("stroke-width",2).attr("stroke-dasharray","5,5")):t(s)>600?(a.append("text").attr("class","net-variation-text").attr("x",560).attr("y",-10).attr("fill","black").attr("font-size","14px").attr("font-weight","bold").text(f),a.append("line").attr("class","slope-line").attr("x1",t(s)).attr("x2",t(i)).attr("y1",e(M)).attr("y2",e(E)).attr("stroke","blue").attr("stroke-width",2).attr("stroke-dasharray","5,5")):t(i)<350&&t(s)<150?(a.append("text").attr("class","net-variation-text").attr("x",0).attr("y",-10).attr("fill","black").attr("font-size","14px").attr("font-weight","bold").text(f),a.append("line").attr("class","slope-line").attr("x1",t(s)).attr("x2",t(i)).attr("y1",e(M)).attr("y2",e(E)).attr("stroke","blue").attr("stroke-width",2).attr("stroke-dasharray","5,5")):(a.append("text").attr("class","net-variation-text").attr("x",(t(i)-t(s))/2+t(s)-170).attr("y",-10).attr("fill","black").attr("font-size","14px").attr("font-weight","bold").text(f),a.append("line").attr("class","slope-line").attr("x1",t(s)).attr("x2",t(i)).attr("y1",e(M)).attr("y2",e(E)).attr("stroke","blue").attr("stroke-width",2).attr("stroke-dasharray","5,5"))}}function z(a,t){const e=document.getElementById("region-select"),l=j.filter(n=>!a.includes(n)).sort();e.innerHTML='<option value="" disabled selected>Régions administratives</option>',e.innerHTML+='<option value="all">Tout sélectionner</option>',l.forEach(n=>{const r=document.createElement("option");r.value=n,r.textContent=`${J[n]}`,e.appendChild(r)}),e.addEventListener("change",n=>{const r=n.target.value;if(r==="all")et(a,t);else{t(r);const o=e.querySelector(`option[value="${r}"]`);o&&o.remove()}e.value=""}),B(a,t)}function et(a,t){j.filter(l=>!a.includes(l)).forEach(l=>t(l))}function at(a,t,e){t.includes(a)||(t.push(a),t.sort(),z(t,e),B(t,e))}function nt(a,t,e){const l=t.indexOf(a);l>-1&&(t.splice(l,1),z(t,e)),B(t,e)}function B(a,t){const e=document.querySelector(".selected-regions");e.innerHTML="",a.forEach(l=>{const n=document.createElement("div");n.className="flex p-1.5 justify-between",n.style.backgroundColor=O[l];const r=document.createElement("span");r.textContent=`${J[l]}`;const o=document.createElement("button");o.textContent="x",o.className="btn btn-ghost btn-xs",o.addEventListener("click",()=>{t(l)}),n.appendChild(r),n.appendChild(o),e.appendChild(n)})}function rt(a,t,e){const l=document.getElementById("start-year"),n=document.getElementById("end-year"),r=document.getElementById("start-month"),o=document.getElementById("end-month");l.innerHTML="",n.innerHTML="",r.innerHTML="",o.innerHTML="";for(let s=t.getUTCFullYear();s<=e.getUTCFullYear();s++){const i=document.createElement("option");i.value=s,i.textContent=s,l.appendChild(i);const c=document.createElement("option");c.value=s,c.textContent=s,n.appendChild(c)}const u=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];u.forEach((s,i)=>{const c=document.createElement("option");c.value=i+1,c.textContent=s,r.appendChild(c);const d=document.createElement("option");d.value=i+1,d.textContent=s,o.appendChild(d)});function p(){const s=parseInt(n.value,10),i=parseInt(o.value,10),c=s===e.getUTCFullYear()?e.getUTCMonth()+1:12;o.innerHTML="";for(let d=0;d<c;d++){const m=document.createElement("option");m.value=d+1,m.textContent=u[d],o.appendChild(m)}i<=c?o.value=i:o.value=c}function h(){const s=parseInt(l.value,10),i=parseInt(n.value,10),c=parseInt(r.value,10),d=parseInt(o.value,10);a(s,i,c,d)}l.addEventListener("change",h),n.addEventListener("change",()=>{p(),h()}),r.addEventListener("change",h),o.addEventListener("change",h),l.value=t.getUTCFullYear(),n.value=e.getUTCFullYear(),r.value=t.getUTCMonth()+1,p(),n.value===e.getUTCFullYear().toString()&&(o.value=e.getUTCMonth()+1),h()}function ot(a,t,e){const l=document.getElementById("marker-start-year"),n=document.getElementById("marker-end-year"),r=document.getElementById("marker-start-month"),o=document.getElementById("marker-end-month");l.innerHTML="",n.innerHTML="",r.innerHTML="",o.innerHTML="";for(let s=t.getUTCFullYear();s<=e.getUTCFullYear();s++){const i=document.createElement("option");i.value=s,i.textContent=s,l.appendChild(i);const c=document.createElement("option");c.value=s,c.textContent=s,n.appendChild(c)}const u=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];u.forEach((s,i)=>{const c=document.createElement("option");c.value=i+1,c.textContent=s,r.appendChild(c);const d=document.createElement("option");d.value=i+1,d.textContent=s,o.appendChild(d)});function p(){const s=parseInt(n.value,10),i=parseInt(o.value,10),c=s===e.getUTCFullYear()?e.getUTCMonth()+1:12;o.innerHTML="";for(let d=0;d<c;d++){const m=document.createElement("option");m.value=d+1,m.textContent=u[d],o.appendChild(m)}i<=c?o.value=i:o.value=c}function h(){const s=parseInt(l.value,10),i=parseInt(n.value,10),c=parseInt(r.value,10),d=parseInt(o.value,10);a(s,i,c,d)}l.addEventListener("change",h),n.addEventListener("change",()=>{p(),h()}),r.addEventListener("change",h),o.addEventListener("change",h),l.value=t.getUTCFullYear(),n.value=e.getUTCFullYear(),r.value=t.getUTCMonth()+1,p(),n.value===e.getUTCFullYear().toString()&&(o.value=e.getUTCMonth()+1),h()}let y,v,b,C,I,N,Y,q,k;const st=d3.select(".graph"),H=st.select(".stackedArea-svg"),D={top:40,right:10,bottom:100,left:80};let R,_;function lt(){R=1e3-D.left-D.right,_=600-D.top-D.bottom,H.attr("width",1e3).attr("height",600);const a=H.selectAll("g").data([0]).join("g").attr("transform",`translate(${D.left},${D.top})`);return{width:R,height:_,svg:a}}function A(a){const{width:t,height:e,svg:l}=lt(),{xScale:n,yScale:r,color:o}=P(t,e),p=S(K)(a);if(l.selectAll("*").remove(),a.length===0){l.append("text").attr("x",t/2).attr("y",e/2).attr("text-anchor","middle").attr("font-size","16px").attr("fill","gray").text("Désolé, aucune donnée disponible pour la période ou les régions sélectionnées.");return}if(a.length===1){l.append("text").attr("x",t/2).attr("y",e/2).attr("text-anchor","middle").attr("font-size","16px").attr("fill","gray").text("Veuillez choisir un interval d'au moins un mois");return}Z(n,r,a,p),W(l,p,n,r,o,e,t,X),tt(l,n,r,e,t,a,I,N,Y,q)}d3.csv("https://www.donneesquebec.ca/recherche/dataset/statistiques-du-registre-foncier-du-quebec-sur-le-marche-immobilier/resource/739ac2bb-e549-4bcd-893d-768e37a03af6/download/donn_hypoth_reqst.csv",d3.autoType).then(function(a){k=a;const{minDate:t,maxDate:e}=Q(k);y=t.getUTCFullYear(),v=e.getUTCFullYear(),b=t.getUTCMonth()+1,C=e.getUTCMonth()+1,I=y,N=v,Y=b,q=C;const l=T(k,g,y,v,b,C);A(l),z(g,r=>{at(r,g,n);const o=T(k,g,y,v,b,C);A(o)});function n(r){nt(r,g,n);const o=T(k,g,y,v,b,C);A(o)}B(g,n),rt((r,o,u,p)=>{y=r,v=o,b=u,C=p;const h=T(k,g,y,v,b,C);A(h)},t,e),ot((r,o,u,p)=>{I=r,N=o,Y=u,q=p;const h=T(k,g,y,v,b,C);A(h)},t,e),window.addEventListener("resize",()=>{const r=T(k,g,y,v,b,C);A(r)})});
